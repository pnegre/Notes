{% extends "notes/base.html" %}

{% block head %}

<script type="text/javascript">

$(document).ready(function() {

		$.ajaxSetup({
		error:function(x,e){
				if(x.status==0){
				alert('You are offline!!\n Please Check Your Network.');
				}else if(x.status==404){
				alert('Requested URL not found.');
				}else if(x.status==500){
				alert('Internal Server Error.');
				}else if(x.status==403){
				alert('La sessi√≥ ha caducat');
				}else if(e=='parsererror'){
				alert('Error.\nParsing JSON Request failed.');
				}else if(e=='timeout'){
				alert('Request Time out.');
				}else {
				alert('Unknow Error.\n'+x.responseText);
				}
				window.location.replace("/");

			}
		});


		$(".nts").change(function() {
			t = $(this);
			data = {
				'nota': t.val(),
				'alumne': t.attr('id_al'),
				'assignatura': {{ assignatura.id }},
				'tnota': t.attr('id_tn'),
				'inter': {{ inter.id }},
			};
			$.post("/notes/nnota", data);


		});

		$(".ncom").click(function() {
			var s = $(this).parent().serialize();
			$.post("/notes/noucomentari", s, function() { alert("Comentari actualitzat"); } );
			return false;

		});



});


</script>

<style type="text/css">

</style>


{% endblock %}


{% block content %}


<h1> Grup: {{ grup }} </h1>
<h2> Assignatura: {{ assignatura.nom }} </h2>

<table>
	<thead>
	<tr><th>.</th>
		{% for t in tipnotes %}
			<th>{{ t.nom }}</th>
		{% endfor %}
		<th> Comentari </th>
	</tr>
	</thead>

	<tbody>

	{% for al in alumnes %}
	<tr> <th> {{ al }} </th>

			{% for t in al.notes %}
				<td>
				<select class="nts" id_al="{{al.id}}" id_tn="{{t.tipnota.id}}" title="{{t.tipnota.nom}}" {% if desactivat %} disabled="1" {% endif %} >
					<option value="-1"></option>
				{% for i in t.tipnota.grupNota.itemnota_set.all %}
					{% ifequal i.id t.nota.nota.id %}
						<option value="{{ i.id }}" selected="selected">{{ i.it }}</option>
					{% else %}
						<option value="{{ i.id }}">{{ i.it }}</option>
					{% endifequal %}

				{% endfor %}
				</select>
				</td>
			{% endfor %}
			<td>

			<form method="POST">
			<textarea name="comentari" rows="3" cols="20"  {% if desactivat %} disabled="1" {% endif %} >{{ al.comm }}</textarea>
			<br>
			<input type="hidden" name="al" value="{{al.id}}">
			<input type="hidden" name="as" value="{{assignatura.id}}">
			<input type="hidden" name="inter" value="{{inter.id}}">
			<input type="submit" name="envia" value="Actualitza" class="ncom"  {% if desactivat %} disabled="1" {% endif %} >

			</form>

			</td>

	</tr>
	{% endfor %}

	</tbody>
</table>

{% endblock %}
